<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Assistente Triunfo</title>
<link rel="stylesheet" href="https://cdn.botframework.com/botframework-webchat/latest/webchat.css" />
<style>
:root{
  --bg-dark:#070A10; --bg-panel:#0B1220; --green:#22C55E; 
  --green-soft:rgba(34,197,94,.18); --border:rgba(255,255,255,.08); 
  --text:#E8EEFC; --muted:#9CA3AF;
}
*{box-sizing:border-box;}
html,body{height:100%; margin:0; background:linear-gradient(180deg,var(--bg-dark),var(--bg-panel)); color:var(--text); overflow: hidden;}
body{ display:flex; justify-content:center; align-items:center; font-family: Segoe UI, sans-serif; }

.chat-container{
  width: 95%; max-width: 1100px; height: 90vh;
  background:rgba(15,23,42,.75); border:1px solid var(--border);
  border-radius:20px; display:flex; flex-direction:column; overflow:hidden;
  backdrop-filter:blur(10px);
}

.chat-header{
  display:flex; justify-content:space-between; align-items:center;
  padding:14px 20px; border-bottom:1px solid var(--border); background:rgba(0,0,0,.3);
}

.logo{ height:22px; }

/* ÁREA DO CHAT - O segredo está aqui */
#webchat-wrapper {
  flex: 1;
  display: flex;
  flex-direction: column;
  overflow: hidden;
  position: relative;
}

#webchat {
  height: 100%;
  width: 100%;
}

/* Forçando o estilo das bolhas via CSS caso o styleOptions falhe */
.webchat__bubble__content {
  border-radius: 10px !important;
}

button{
  background:var(--green-soft); border:1px solid var(--green); color:white;
  padding:8px 14px; border-radius:14px; cursor:pointer; font-weight:600;
}
</style>
</head>
<body>

<div class="chat-container">
  <div class="chat-header">
    <div style="display:flex; align-items:center; gap:15px;">
      <img class="logo" src="https://triunfologistica.com.br/wp-content/uploads/2023/09/Triunfo_NOVO_horizontal-branca.png" />
      <div style="font-weight:700; font-size:16px;">Triunfo Bot</div>
          <div class="header-text">
            <div class="header-title">Assistente Triunfo</div>
            <div class="header-sub">https://triunfologistica.com.br/</div> 
          </div> 
        </div>
    </div>
    <button onclick="restartChat()">Limpar conversa</button>
  </div>

  <div id="webchat-wrapper">
    <div id="webchat"></div>
  </div>
</div>

<script src="https://cdn.botframework.com/botframework-webchat/latest/webchat.js"></script>
<script>
const directLineSecret = "BhiuQCvJMH9ZOvzOJ9lx0TWpQ1ztXWA2lCYWoNOxfRwLG15x53AgJQQJ99BHACL93NaAArohAAABAZBS4EtK.6Sde7jEcs7g6XibB7vZp8lmLIRhy2WDUmaBkfLHzs84X1g8ZR7R7JQQJ99CBACHYHv6AArohAAABAZBSoSj9";

async function startChat() {
  const tokenResponse = await fetch("https://directline.botframework.com/v3/directline/tokens/generate", {
    method: "POST",
    headers: { "Authorization": "Bearer " + directLineSecret }
  });
  const { token } = await tokenResponse.json();

  const styleOptions = {
    backgroundColor: 'transparent',
    
    // Bolhas do Bot (Cinza)
    bubbleBackground: '#374151',
    bubbleTextColor: 'white',
    bubbleBorderRadius: 10,
    bubblePadding: 8, // Bolha menor
    
    // Bolhas do Usuário (Branco)
    bubbleFromUserBackground: '#FFFFFF',
    bubbleFromUserTextColor: 'black',
    bubbleFromUserBorderRadius: 10,
    bubbleFromUserPadding: 8, // Bolha menor
    
    // Tamanhos gerais
    bubbleMinHeight: 20,
    bubbleMaxWidth: 450,
    fontSizeSmall: '12px',

    // Barra de Digitação
    sendBoxBackground: 'rgba(0,0,0,0.4)',
    sendBoxTextColor: 'white',
    sendBoxHeight: 50
  };

  window.WebChat.renderWebChat({
    directLine: window.WebChat.createDirectLine({ token }),
    styleOptions: styleOptions,
    locale: 'pt-BR'
  }, document.getElementById('webchat'));
}

// FUNÇÃO RESTART CORRIGIDA
function restartChat() {
  const wrapper = document.getElementById('webchat-wrapper');
  // Removemos o elemento antigo e criamos um novo do zero para limpar a memória do componente
  wrapper.innerHTML = '<div id="webchat"></div>';
  startChat();
}

startChat();
</script>
</body>
</html>
